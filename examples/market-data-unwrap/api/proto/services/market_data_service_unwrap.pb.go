// Code generated by protoc-gen-go-http. DO NOT EDIT.
// source: proto/services/market_data_service.proto

package services

import (
	models "github.com/SebastienMelki/sebuf/examples/market-data-unwrap/api/proto/models"
)

import (
	"encoding/json"

	"google.golang.org/protobuf/encoding/protojson"
)

// MarshalJSON implements json.Marshaler for GetOptionBarsResponse.
// This method handles unwrap field serialization for map values.
func (x *GetOptionBarsResponse) MarshalJSON() ([]byte, error) {
	if x == nil {
		return []byte("null"), nil
	}

	out := make(map[string]json.RawMessage)

	// Handle unwrap map field: Bars
	if x.Bars != nil {
		mapData := make(map[string]json.RawMessage)
		for k, wrapper := range x.Bars {
			if wrapper != nil {
				// Marshal the unwrap field directly (the array)
				items := make([]json.RawMessage, 0, len(wrapper.GetBars()))
				for _, item := range wrapper.GetBars() {
					data, err := protojson.Marshal(item)
					if err != nil {
						return nil, err
					}
					items = append(items, data)
				}
				arrayData, err := json.Marshal(items)
				if err != nil {
					return nil, err
				}
				mapData[k] = arrayData
			}
		}
		data, err := json.Marshal(mapData)
		if err != nil {
			return nil, err
		}
		out["bars"] = data
	}

	// Handle scalar field: NextPageToken
	if x.NextPageToken != "" {
		data, err := json.Marshal(x.NextPageToken)
		if err != nil {
			return nil, err
		}
		out["nextPageToken"] = data
	}

	return json.Marshal(out)
}

// UnmarshalJSON implements json.Unmarshaler for GetOptionBarsResponse.
// This method handles unwrap field deserialization for map values.
func (x *GetOptionBarsResponse) UnmarshalJSON(data []byte) error {
	var raw map[string]json.RawMessage
	if err := json.Unmarshal(data, &raw); err != nil {
		return err
	}

	// Handle unwrap map field: Bars
	if rawField, ok := raw["bars"]; ok {
		var mapRaw map[string]json.RawMessage
		if err := json.Unmarshal(rawField, &mapRaw); err != nil {
			return err
		}
		x.Bars = make(map[string]*models.OptionBarsList)
		for k, arrayRaw := range mapRaw {
			var itemsRaw []json.RawMessage
			if err := json.Unmarshal(arrayRaw, &itemsRaw); err != nil {
				return err
			}
			items := make([]*models.OptionBar, 0, len(itemsRaw))
			for _, itemRaw := range itemsRaw {
				item := &models.OptionBar{}
				if err := protojson.Unmarshal(itemRaw, item); err != nil {
					return err
				}
				items = append(items, item)
			}
			x.Bars[k] = &models.OptionBarsList{Bars: items}
		}
	}

	// Handle field: NextPageToken
	if rawField, ok := raw["nextPageToken"]; ok {
		if err := json.Unmarshal(rawField, &x.NextPageToken); err != nil {
			return err
		}
	}

	return nil
}
