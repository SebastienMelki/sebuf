openapi: 3.1.0
info:
    title: StockDataService API
    version: 1.0.0
paths:
    /v1/stocks/bars:
        get:
            tags:
                - StockDataService
            summary: GetStockBars
            description: GetStockBars retrieves historical stock bars for the specified symbols.
            operationId: GetStockBars
            parameters:
                - name: X-API-Key
                  in: header
                  description: API key for authentication
                  required: true
                  schema:
                    type: string
                    example: sk_live_xxxxx
                - name: symbols
                  in: query
                  description: Comma-separated list of stock symbols.
                  required: false
                  schema:
                    type: string
                - name: timeframe
                  in: query
                  description: Bar timeframe (e.g., 1Min, 5Min, 1Hour, 1Day).
                  required: false
                  schema:
                    type: string
                - name: start
                  in: query
                  description: Start timestamp (RFC 3339 or YYYY-MM-DD).
                  required: false
                  schema:
                    type: string
                - name: end
                  in: query
                  description: End timestamp (RFC 3339 or YYYY-MM-DD).
                  required: false
                  schema:
                    type: string
                - name: limit
                  in: query
                  description: Maximum number of bars to return.
                  required: false
                  schema:
                    type: integer
                    format: int32
            responses:
                "200":
                    description: Successful response
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetStockBarsResponse'
                "400":
                    description: Validation error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ValidationError'
                default:
                    description: Error response
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error:
                                        type: string
                                    code:
                                        type: integer
components:
    schemas:
        FieldViolation:
            type: object
            properties:
                field:
                    type: string
                    description: The field path that failed validation (e.g., 'user.email' for nested fields). For header validation, this will be the header name (e.g., 'X-API-Key')
                description:
                    type: string
                    description: Human-readable description of the validation violation (e.g., 'must be a valid email address', 'required field missing')
            required:
                - field
                - description
            description: FieldViolation describes a single validation error for a specific field.
        ValidationError:
            type: object
            properties:
                violations:
                    type: array
                    items:
                        $ref: '#/components/schemas/FieldViolation'
                    description: List of validation violations
            required:
                - violations
            description: ValidationError is returned when request validation fails. It contains a list of field violations describing what went wrong.
        GetStockBarsRequest:
            type: object
            properties:
                symbols:
                    type: string
                    examples:
                        - AAPL,GOOG,MSFT
                    description: Comma-separated list of stock symbols.
                    example: AAPL,GOOG,MSFT
                timeframe:
                    type: string
                    examples:
                        - 1Day
                    description: Bar timeframe (e.g., 1Min, 5Min, 1Hour, 1Day).
                    example: 1Day
                start:
                    type: string
                    examples:
                        - 2025-12-01
                    description: Start timestamp (RFC 3339 or YYYY-MM-DD).
                    example: 2025-12-01
                end:
                    type: string
                    examples:
                        - 2025-12-31
                    description: End timestamp (RFC 3339 or YYYY-MM-DD).
                    example: 2025-12-31
                limit:
                    type: integer
                    examples:
                        - 100
                    maximum: 10000
                    minimum: 1
                    format: int32
                    description: Maximum number of bars to return.
                    example: 100
            required:
                - symbols
                - timeframe
            description: GetStockBarsRequest is the request to get historical stock bars.
        GetStockBarsResponse:
            type: object
            properties:
                bars:
                    type: object
                    additionalProperties:
                        $ref: '#/components/schemas/StockBarsList'
                    description: Map of symbol to list of bars. Each symbol maps directly to an array of bars.
                nextPageToken:
                    type: string
                    description: Next page token for pagination, null if no more pages.
            description: |-
                GetStockBarsResponse contains the stock bars data.
                 The map values use the unwrap annotation for cleaner JSON serialization:
                 {"bars": {"AAPL": [...bars...]}} instead of {"bars": {"AAPL": {"bars": [...]}}}

                 IMPORTANT: StockBarsList is imported from stock_bar.proto which is in the SAME
                 Go package but a DIFFERENT file. This tests same-package-different-file unwrap resolution.
        BarsEntry:
            type: object
            properties:
                key:
                    type: string
                value:
                    $ref: '#/components/schemas/StockBarsList'
        StockBarsList:
            type: object
            properties:
                bars:
                    type: array
                    items:
                        $ref: '#/components/schemas/StockBar'
            description: |-
                StockBarsList is a wrapper for a list of bars that will be unwrapped in JSON.
                 This enables map values to serialize as arrays instead of nested objects.

                 IMPORTANT: This message is in a DIFFERENT FILE but SAME PACKAGE as the service
                 that uses it. This tests the same-package-different-file unwrap resolution.
        StockBar:
            type: object
            properties:
                t:
                    type: string
                    examples:
                        - 2025-12-15T15:05:00Z
                    description: Timestamp in RFC 3339 format.
                    example: 2025-12-15T15:05:00Z
                o:
                    type: number
                    examples:
                        - 143.08
                    format: double
                    description: Open price.
                    example: 143.08
                h:
                    type: number
                    examples:
                        - 145.00
                    format: double
                    description: High price.
                    example: 145.00
                l:
                    type: number
                    examples:
                        - 142.50
                    format: double
                    description: Low price.
                    example: 142.50
                c:
                    type: number
                    examples:
                        - 144.25
                    format: double
                    description: Close price.
                    example: 144.25
                v:
                    type: integer
                    examples:
                        - 1000000
                    format: int64
                    description: Volume.
                    example: 1000000
            description: StockBar represents a stock OHLCV bar data point.
