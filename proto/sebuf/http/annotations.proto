syntax = "proto3";

package sebuf.http;

import "google/protobuf/descriptor.proto";

option go_package = "github.com/SebastienMelki/sebuf/http;http";

// HttpMethod specifies the HTTP verb for an RPC method
enum HttpMethod {
  // Unspecified defaults to POST for backward compatibility
  HTTP_METHOD_UNSPECIFIED = 0;
  HTTP_METHOD_GET = 1;
  HTTP_METHOD_POST = 2;
  HTTP_METHOD_PUT = 3;
  HTTP_METHOD_DELETE = 4;
  HTTP_METHOD_PATCH = 5;
}

// HttpConfig defines HTTP-specific configuration for an RPC method
message HttpConfig {
  // The HTTP path for this method (supports path variables like /users/{id})
  string path = 1;

  // The HTTP method (GET, POST, PUT, DELETE, PATCH). Defaults to POST if unspecified.
  HttpMethod method = 2;
}

// Extension for method options
extend google.protobuf.MethodOptions {
  HttpConfig config = 50003;
}

// ServiceConfig defines HTTP-specific configuration for an entire service
message ServiceConfig {
  // Base path prefix for all methods in this service
  string base_path = 1;
}

// Extension for service options
extend google.protobuf.ServiceOptions {
  ServiceConfig service_config = 50004;
}

// FieldExamples defines example values for a field
message FieldExamples {
  // List of example values for this field
  repeated string values = 1;
}

// QueryConfig defines query parameter configuration for a message field
message QueryConfig {
  // The query parameter name in the URL (e.g., "page_size" for ?page_size=10)
  string name = 1;

  // Whether this query parameter is required
  bool required = 2;
}

// Int64Encoding controls how int64/uint64 fields serialize to JSON
enum Int64Encoding {
  // Follow protojson default (serialize as string)
  INT64_ENCODING_UNSPECIFIED = 0;
  // Explicit string encoding: "12345"
  INT64_ENCODING_STRING = 1;
  // Numeric encoding: 12345 (precision warning for values > 2^53)
  INT64_ENCODING_NUMBER = 2;
}

// EnumEncoding controls how enum fields serialize to JSON
enum EnumEncoding {
  // Follow protojson default (serialize as proto name string)
  ENUM_ENCODING_UNSPECIFIED = 0;
  // Explicit string encoding: "STATUS_ACTIVE"
  ENUM_ENCODING_STRING = 1;
  // Numeric encoding: 1
  ENUM_ENCODING_NUMBER = 2;
}

// Extension for field-level options
extend google.protobuf.FieldOptions {
  // Example values for documentation/OpenAPI
  FieldExamples field_examples = 50007;

  // Query parameter configuration for a field
  QueryConfig query = 50008;

  // Mark a repeated field for unwrapping when parent message is a map value.
  // When set to true on a repeated field, and the message containing this field
  // is used as a map value, the JSON serialization will collapse the wrapper
  // to just the unwrapped field's array value.
  // Constraints: Only valid on repeated fields, only one per message.
  bool unwrap = 50009;

  // Controls int64/uint64 JSON encoding for this field.
  // Valid on: int64, sint64, sfixed64, uint64, fixed64 fields.
  // Default: STRING encoding (protojson default for JavaScript precision safety).
  optional Int64Encoding int64_encoding = 50010;

  // Controls enum JSON encoding for this field.
  // Valid on: enum fields only.
  // Default: STRING encoding (protojson default using proto enum names).
  optional EnumEncoding enum_encoding = 50011;
}

// Extension for enum value options
extend google.protobuf.EnumValueOptions {
  // Custom JSON string for this enum value (e.g., "active" instead of "STATUS_ACTIVE").
  // When set, this value is used for JSON serialization instead of the proto name.
  // Combines with enum_encoding=STRING on fields using this enum.
  optional string enum_value = 50012;
}